$(function(){Catalog.init()});var Catalog=function(){function t(t){var a=window.location.search,n={};if(a){a=a.slice(1).split("&");var e=a.length;if(e)for(var o=0;e>o;o++){var i=a[o].split("=");2==i.length&&(n[i[0]]=i[1])}}"undefined"!=typeof t&&2==t.length&&(n[t[0]]=t[1]),$.ajax({url:"/index/get-catalog-ajax",method:"POST",dataType:"json",data:n,success:function(t){if(t.success){var a=[];for(property in t.request)("page"!=property||1!=t.request[property])&&a.push(property+"="+t.request[property]);var n=window.location.pathname+"?"+a.join("&");history.pushState({type:"url"},"url",n),$(".products-list").html(t.products)}}})}function a(t){$.ajax({url:"/index/edit-product-ajax",method:"post",dataType:"json",data:{id:t},success:function(t){var a=$("#edit-product-modal");a.find(".modal-title").html(t.title),a.find(".modal-body").html(t.form),a.modal("show")}})}function n(t){$.ajax({url:"/index/delete-product-ajax",method:"post",dataType:"json",data:{id:t},success:function(a){if(1==a.success){var n=$("#product-"+t);n.append('<div class="cover"><span class="cover-label">Удалено!</span><a href="#" class="btn btn-sm btn-danger" data-action="recover-product" data-id="'+t+'">Восстановить</a></div>').find(".product-content").animate({opacity:.35},150)}}})}function e(t){$.ajax({url:"/index/recover-product-ajax",method:"post",dataType:"json",data:{id:t},success:function(a){if(1==a.success){var n=$("#product-"+t);n.find(".cover").remove(),n.find(".product-content").animate({opacity:1},150)}}})}var o=function(){$(document).on("click",'a[data-action="add-product"]',function(){return a(0),!1}).on("click",'a[data-action="edit-product"]',function(){var t=$(this).attr("data-id");return a(t),!1}).on("click",'a[data-action="delete-product"]',function(){var t=$(this).attr("data-id");return n(t),!1}).on("click",'a[data-action="recover-product"]',function(){var t=$(this).attr("data-id");return e(t),!1}).on("click",'button[data-action="save-product"]',function(){var a=$("#edit-product-form"),n={id:a.find("input[name=id]").val(),name:a.find("input[name=name]").val(),description:a.find("textarea[name=description]").val(),status:a.find("select[name=status] option:selected").val(),price:a.find("input[name=price]").val()},e={};if(n.name.length||(e.name="Введите название товара"),n.status.length||(e.status="Выберите статус товара"),n.price.length||(e.price="Введите цену товара"),$.isEmptyObject(e))$.ajax({url:"/index/save-product-ajax",method:"post",dataType:"json",data:n,success:function(a){if(1==a.success){var n=$("#edit-product-modal");n.modal("hide"),n.on("hidden.bs.modal",function(a){t()})}}});else{var o=a.find(".alert");for(property in e)o.append(e[property]+"<br />"),a.find("*[name="+property+"]").closest(".form-group").addClass("has-error");o.fadeIn()}return!1}).on("change",".page-actions .controls select",function(){var a=$(this).attr("name"),n=$(this).find("option:selected").val();t([a,n])}).on("click",".page-actions .pagination a[data-page]",function(){var a=$(this).attr("data-page");t(["page",a])})};return{init:function(){o()}}}();